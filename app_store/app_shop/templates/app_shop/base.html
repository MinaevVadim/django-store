{% load mptt_tags %}
{% load static %}
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css"
        integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
        integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
        crossorigin="anonymous"></script>
  <title>Megano</title>
  <meta name="description" content="Описание страницы">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
  <link href='{% static "favicon.ico" %}' rel="shortcut icon">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Regular.woff" %}' as="font">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Italic.woff" %}' as="font">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Bold.woff" %}' as="font">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Bold_Italic.woff" %}' as="font">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Light.woff" %}' as="font">
  <link rel="preload" href='{% static "fonts/Roboto/Roboto-Light_Italic.woff" %}' as="font">
  <link rel="stylesheet" href='{% static "css/fonts.css" %}'>
  <link rel="stylesheet" href='{% static "css/basic.css" %}'>
  <link rel="stylesheet" href='{% static "css/extra.css" %}'>
  <script src='{% static "plg/CountDown/countdown.js" %}'></script><!--[if lt IE 9]>
  <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
</head>
<style>
    .not-visible {
        display: none;
    }
</style>
<body class="Site">
  <header class="Header">
    <div class="ControlPanel">
      <div class="wrap">
        <div class="row ControlPanel-row">
          <div class="row-block">
            <div class="row ControlPanel-rowSplit">
              <div class="row-block"><a class="ControlPanel-title" href="#">Free Delivery</a>
              </div>
              <div class="row-block hide_700"><span class="ControlPanel-title">Follow Us</span>
                <ul class="menu menu_img menu_smallImg ControlPanel-menu">
                  <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialHeader/fb.svg" %}' alt="fb.svg"/></a>
                  </li>
                  <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialHeader/tw.svg" %}' alt="tw.svg"/></a>
                  </li>
                  <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialHeader/in.svg" %}' alt="in.svg"/></a>
                  </li>
                  <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialHeader/pt.svg" %}' alt="pt.svg"/></a>
                  </li>
                  <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialHeader/mail.svg" %}' alt="mail.svg"/></a>
                  </li>
                </ul>
              </div>
            </div>
          </div>
          <nav class="row-block">
            <div class="row ControlPanel-rowSplit">
              {% if request.user.is_authenticated %}
                  <div class="row-block"><a class="ControlPanel-title" href="{% url 'account' %}">Личный кабинет/</a>
                  <div class="row-block"><a class="ControlPanel-title" href="{% url 'logout' %}">Выйти</a>
              {% else %}
                  <div class="row-block"><a class="ControlPanel-title" href="{% url 'login_user' %}">Вход/</a>
                  <div class="row-block"><a class="ControlPanel-title" href="{% url 'register_user' %}">Регистрация</a>
              {% endif %}
              </div>
            </div>
          </nav>
        </div>
      </div>
    </div>
    <div class="wrap">
      <div class="row Header-rowMain">
        <div class="row-block Header-logo"><a class="logo" href="{% url 'main' %}"><img class="logo-image" src='{% static "img/logo.png" %}' alt="logo.png"/></a>
        </div>
        <nav class="row-block row-block_right Header-menu">
          <div class="menuModal" id="navigate">
            <ul class="menu menu_main">
              <li class="menu-item"><a class="menu-link" href="{% url 'main' %}">Домой</a>
              </li>
              <li class="menu-item"><a class="menu-link" href="{% url 'about' %}">Мы</a>
              </li>
              <li class="menu-item"><a class="menu-link" href="{% url 'catalog' %}">Каталог</a>
              </li>
            </ul>
          </div>
        </nav>
        <div class="row-block">
          <div class="CartBlock"><a class="CartBlock-block" href="{% url 'cart_user' %}"><img class="CartBlock-img" src='{% static "img/icons/cart.svg" %}' alt="cart.svg"/><span class="CartBlock-amount">{{ count_cart }}</span></a>
            <div class="CartBlock-block"><span class="CartBlock-price">{{ common_price }} руб.</span>
            </div>
          </div>
        </div>
        <div class="row-block Header-trigger"><a class="menuTrigger" href="#navigate">
            <div class="menuTrigger-content">Показать навигацию
            </div><span></span><span></span><span></span></a>
        </div>
      </div>
    </div>
    <div class="Header-searchWrap">
      <div class="wrap">
        <div class="Header-categories">
          <div class="CategoriesButton">
            <div class="CategoriesButton-title">
              <div class="CategoriesButton-icon"><img src='{% static "img/icons/allDep.svg" %}' alt="allDep.svg"/>
              </div><span class="CategoriesButton-text">Категории товаров</span>
              <div class="CategoriesButton-arrow">
              </div>
            </div>
            <div class="CategoriesButton-content">
              {% recursetree categories %}
              <div class="CategoriesButton-link"><a href="{% url 'catalog' %}?category={{ node.name }}">
                  <div class="CategoriesButton-icon"><img src='/media/{{ node.file_icon }}' alt="card.jpg"/>
                  </div><span class="CategoriesButton-text">{{ node.name }}</span></a>
                <div class="CategoriesButton-submenu">
                  {{ children }}
                </div>
              </div>
              {% endrecursetree %}
            </div>
          </div>
        </div>
        <div class="Header-searchLink"><img src='{% static "img/icons/search.svg" %}' alt="search.svg"/>
        </div>
        <div class="Header-search">
          <div class="search">
            <form class="form form_search" action="{% url 'catalog' %}" method="post">
                {% csrf_token %}
              <input class="search-input" id="query" name="query" type="text" placeholder="What are you looking for ..."/>
              <button class="search-button" type="submit" name="search" id="search"><img src='{% static "img/icons/search.svg" %}' alt="search.svg"/>Search
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  </header>
  {% block content %}
  {% endblock %}
<footer class="Footer">
    <div class="wrap">
      <div class="row Footer-main">
        <div class="row-block"><a class="logo Footer-logo" href="#"><img class="logo-image" src='{% static "img/logo_footer.png" %}' alt="logo_footer.png"/></a>
          <p>Добро пожаловать на мой первый сайт!
          </p>
          <ul class="menu menu_img menu_smallImg Footer-menuSoc">
            <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialFooter/fb.svg" %}' alt="fb.svg"/></a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialFooter/tw.svg" %}' alt="tw.svg"/></a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialFooter/in.svg" %}' alt="in.svg"/></a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialFooter/pt.svg" %}' alt="pt.svg"/></a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#"><img src='{% static "img/icons/socialFooter/mail.svg" %}' alt="mail.svg"/></a>
            </li>
          </ul>
        </div>
        <div class="row-block">
          <strong class="Footer-title">Полезные ссылки
          </strong>
          <ul class="menu menu_vt Footer-menu">
            <li class="menu-item"><a class="menu-link" href="#">Проверка</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Моя карта</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Доставка</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Информация о заказе</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Правила</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Условия</a>
            </li>
          </ul>
        </div>
        <div class="row-block">
          <strong class="Footer-title">Мой аккаунт
          </strong>
          <ul class="menu menu_vt Footer-menu">
            <li class="menu-item"><a class="menu-link" href="#">Аксессуары</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Гарнитура</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Камеры</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Одежда</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Электроника</a>
            </li>
            <li class="menu-item"><a class="menu-link" href="#">Мода</a>
            </li>
          </ul>
        </div>
        <div class="row-block">
          <strong class="Footer-title">Контакты
          </strong>
          <p>Телефон: 8.800.800.800<br>Электронная почта: first.site@yandex.ru<br>Skype: Skype<br>Адрес: г.Санкт-Петербург<br>Решентикова 0/0<br>9999
          </p>
        </div>
      </div>
    </div>
    <div class="Footer-copy">
      <div class="wrap">
        <div class="row row_space">
          <div class="row-block">© авторское право&#32;<a href="#">Megano Store.</a>&#32;Все права защищены.
          </div>
          <div class="row-block"><span>доступные платежи</span>
            <div class="Footer-payments">
              <div><img src='{% static "img/payments/visa.png" %}' alt="visa.png"/>
              </div>
              <div><img src='{% static "img/payments/mastercard.png" %}' alt="mastercard.png"/>
              </div>
              <div><img src='{% static "img/payments/paypal.png" %}' alt="paypal.png"/>
              </div>
              <div><img src='{% static "img/payments/american.png" %}' alt="american.png"/>
              </div>
              <div><img src='{% static "img/payments/electron.png" %}' alt="electron.png"/>
              </div>
              <div><img src='{% static "img/payments/maestro.png" %}' alt="maestro.png"/>
              </div>
              <div><img src='{% static "img/payments/delta.png" %}' alt="delta.png"/>
              </div>
              <div><img src='{% static "img/payments/e.png" %}' alt="e.png"/>
              </div>
              <div><img src='{% static "img/payments/dk.png" %}' alt="dk.png"/>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3" crossorigin="anonymous"></script>
  <script src='{% static "plg/form/jquery.form.js" %}'></script>
  <script src='{% static "plg/form/jquery.maskedinput.min.js" %}'></script>
  <script src='{% static "plg/range/ion.rangeSlider.min.js" %}'></script>
  <script src='{% static "plg/Slider/slick.min.js" %}'></script>
  <script src='{% static "js/scripts.js" %}'></script>
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src='{% static "js/jquery.maskedinput.min.js" %}'></script>
  <script>
      $(document).ready(function() {
        $('#number').mask('+7 (999) 999-99-99');
        $('#number1').mask('+7 (999) 999-99-99');
      });
  </script>
 <script>
        // var _current_item = $('.single_content').length
        // console.log(_current_item);
        const loadBtn = document.getElementById('btn');
        const spinner = document.getElementById('spinner');
        const total = JSON.parse(document.getElementById('json-total').textContent);
        const alert = document.getElementById('alert');

        function loadmorePost() {
            var _current_item = $('.single_content').length
            const content_container = document.getElementById("content");
            $.ajax({
                url: '{% url "load_more" %}',
                type: 'GET',
                data: {
                    'loaded_item': _current_item
                },
                beforeSend: function () {
                    loadBtn.classList.add('not-visible');
                    spinner.classList.remove('not-visible');
                },
                success: function (response) {
                    const data = response.posts
                    spinner.classList.add('not-visible')
                    data.map(post => {
                        console.log(post.title);
                        content_container.innerHTML += `<div class="single_content mt-2 pl-2">
                                                            <div class="Comments">
                                                            <div class="Comment">
                                                            <div class="Comment-column Comment-column_pict">
                                                                <img class="Comment-avatar" src='/media/${post.image_avatar}'/>
                                                            </div>
                                                            <div class="Comment-column">
                                                            <header class="Comment-header">
                                                              <div>
                                                                <strong class="Comment-title">${post.name_user}
                                                                </strong><span class="Comment-date">${post.date_comment}</span>
                                                              </div>
                                                            </header>
                                                            <div class="Comment-content">${post.text_comment}
                                                            </div>
                                                            </div>
                                                            </div>
                                                            </div>
                                                        </div>`
                    })
                    if (_current_item == total) {
                         $("#btn").remove();
                    } else {
                        $("#btn").removeClass('disabled').text('Подгрузить ещё');
                    }
                },
                error: function (err) {
                    console.log(err);
                },
            });
        }
        loadBtn.addEventListener('click', () => {
            loadmorePost()
        });
  </script>
</body>
</html>